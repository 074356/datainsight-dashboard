<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weather Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="container py-4">
  <header class="mb-4">
    <h1 class="text-center mb-3">üå¶Ô∏è Weather Dashboard</h1>
    <nav class="text-center">
      <a href="index.html" class="btn btn-primary mx-1">Home</a>
      <a href="crud-weather.html" class="btn btn-outline-secondary mx-1">CRUD Page</a>
    </nav>
  </header>

  <main>
    <div class="mb-4">
      <h2 class="h4">üîç Search City Weather</h2>
      <input type="text" id="cityInput" class="form-control mb-2" placeholder="Enter city name..." />
      <button class="btn btn-success" onclick="getWeather()">Get Weather</button>
    </div>

    <div id="loading" style="display:none;">Loading data...</div>
    <div id="weatherData" class="mb-4"></div>
    <canvas id="weatherChart" width="400" height="200"></canvas>
  </main>

  <footer class="text-center mt-5">
    <p>&copy; 2025 DataInsight Dashboards</p>
  </footer>

  <script>
    const API_KEY = "06bba629fa20cb6ecda05a946534f60a"; // OpenWeatherMap API Key

    async function getWeather() {
      const city = document.getElementById("cityInput").value.trim();
      const loading = document.getElementById("loading");
      const weatherDiv = document.getElementById("weatherData");
      const ctx = document.getElementById('weatherChart').getContext('2d');

      loading.style.display = "block";
      weatherDiv.innerHTML = "";

      try {
        const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&appid=${API_KEY}`);
        const data = await res.json();

        if (data.cod !== "200") {
          weatherDiv.innerHTML = `<div class="alert alert-danger">City not found</div>`;
          loading.style.display = "none";
          return;
        }

        const first = data.list[0];
        const info = `
          <div class="card p-3">
            <h3>${data.city.name}, ${data.city.country}</h3>
            <p><strong>Temperature:</strong> ${first.main.temp} ¬∞C</p>
            <p><strong>Weather:</strong> ${first.weather[0].description}</p>
            <p><strong>Humidity:</strong> ${first.main.humidity}%</p>
            <p><strong>Wind:</strong> ${first.wind.speed} m/s</p>
          </div>`;

        weatherDiv.innerHTML = info;

        // Prepare chart data
        const labels = data.list.map(item => item.dt_txt);
        const temps = data.list.map(item => item.main.temp);

        new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'Temperature (¬∞C)',
              data: temps,
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 2,
              fill: false
            }]
          },
          options: {
            responsive: true,
            scales: {
              x: {
                display: true,
                title: {
                  display: true,
                  text: 'Date/Time'
                }
              },
              y: {
                display: true,
                title: {
                  display: true,
                  text: 'Temperature (¬∞C)'
                }
              }
            }
          }
        });

        loading.style.display = "none";
      } catch (error) {
        loading.innerText = "Error loading data";
        console.error(error);
      }
    }
  </script>
</body>
</html>
